_base_ = ["stage2.py"]

plugin_config = dict(
    sp_size=4,
)
dataset = dict(
    memory_efficient=True,
)
grad_ckpt_buffer_size = 25 * 1024**3
async_io = False
bucket_config = {
    "_delete_": True,
    "768px": {
        1: (1.0, 38),
        5: (1.0, 12),
        9: (1.0, 12),
        13: (1.0, 12),
        17: (1.0, 12),
        21: (1.0, 12),
        25: (1.0, 12),
        29: (1.0, 12),
        33: (1.0, 12),
        37: ((1.0, 0.9), 5),
        41: ((1.0, 0.9), 5),
        45: ((1.0, 0.9), 5),
        49: ((1.0, 0.9), 5),
        53: ((1.0, 0.9), 5),
        57: ((1.0, 0.9), 5),
        61: ((1.0, 0.9), 5),
        65: ((1.0, 0.9), 5),
        69: ((1.0, 0.975), 3),
        73: ((1.0, 0.975), 3),
        77: ((1.0, 0.975), 3),
        81: ((1.0, 0.975), 3),
        85: ((1.0, 0.975), 3),
        89: ((1.0, 0.975), 3),
        93: ((1.0, 0.975), 3),
        97: ((1.0, 0.975), 3),
        101: ((1.0, 0.992), 2),
        105: ((1.0, 0.992), 2),
        109: ((1.0, 0.992), 2),
        113: ((1.0, 0.992), 2),
        117: ((1.0, 0.992), 2),
        121: ((1.0, 0.975), 2),
        125: ((1.0, 0.975), 2),
        129: ((1.0, 0.975), 2),
    },
}
ema_decay = None

# cp=4, ckpt act mem: 20.79 GB, 33: (1.0, 12), 36.38s/it
# record_time = True
# record_barrier = True
